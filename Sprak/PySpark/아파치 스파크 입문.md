# 아파치 스파크 입문

아파치 스파크 2.0 기준

교재 일부 발췌 : [아파치 스파크 입문](https://www.hanbit.co.kr/store/books/look.php?p_code=B3640024966)

## 1장. 아파치 스파크란 무엇인가?

### 스파크
여러 번 반복되는 처리와 연속으로 이루어지는 변환처리에서 고속으로 처리 가능하다.

스파크는 연속 처리에서 불필요한 디스크와 네트워크 I/O가 발생하지 않지만 속도와 내결함성은 트레이드오프 관계에 있다.

스파크 내부에서는 병렬 작동을 이한 스케줄링이 이어지고 사용자가 의식하지 않아도 병렬 분산 환경에서 처리가 진행된다.

배치처리, 스트림처리, SQL처리, 머신러닝, 그래프처리와 같은 서로 다른 형태의 애플리케이션을 하나의 환경에서 통합적으로 다룰 수 있다.
  - 운용자는 스파크 운용만 고려하면 되기 때문에 여러 개의 미들웨어를 병행해 운용하는 것보다 간단하다. 

### 맵리듀스 
읽기 -> 분산처리 -> 보존을 반복 수행한다.

맵리듀스는 중간 결과의 데이터셋을 메모리에 유지한 상태로 다시 처리할 수 있는 수단이 제공되지 않아 매번 쿼리를 발행하고 얻은 결과를 디스크에 보존하고 다시 읽어 메모리에 로드해야 한다.

### 스케일업과 스케일아웃
스케일업 : 한 대의 서버에 있는 리소스를 늘리고 강화해 처리 능력이 높은 환경을 마련하는 것, 스케일 아웃보다 비용 소모가 높음(비용 대비 성능이 뛰어나지 않다는 의미)

스케일아웃 : 여러 대의 서버를 통한 병렬분산처리를 이용하는 것


## 2장. 스파크의 처리 모델

### RDD
스파크의 데이터처리 자료구조이며 대량의 데이터를 요소로 가지는 분산 컬렉션이다.

내부는 파티션이라는 단위로 나뉘고 이 `파티션이 분산 처리 단위`이다.

요새는 RDD 대신 DataFrame이 주로 자료구조로 사용되는 듯 하다.

RDD에는 변환과 액션 두 종류의 처리가 적용 가능하다.
 - 변환 : RDD를 가공하고 새로운 RDD를 얻는 처리. 예:filter, map, flatmap, zip, reducekey, join
   - 셔플 : 서로 다른 파티션에 있는 같은 키를 가지는 요소의 자리를 바꾸는 것
 - 액션 : RDD 내용을 바탕으로 데이터를 가공하지 않고 원하는 결과를 얻는 조작. 예:saveAsTextFile, count

RDD 영속화
- 이그제큐터는 태스크 처리를 끝낼 때, 처리 과정에서 생성된 파티션 인스턴스를 영속화하는 경우가 있다. 

### 테스트 스케줄링과 실행
![image](https://user-images.githubusercontent.com/59533593/117096293-91a95400-ada3-11eb-8aab-049db8639011.png)
- 물리적으로 가까운 곳에서 실행되는 이그제큐터를 할당할 수 있다.

### 드라이버 프로그램
실제 처리는 드라이버 프로그램에서 이루어지지 않으며 잡 형태로 클러스터에서 실행된다.

실행 시점은 드라이버 프로그램에서 액션의 적용이 선언될 때까지 지연된다.
